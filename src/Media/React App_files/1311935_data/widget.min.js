(()=>{var MEMORY_KEYS_KEY,MEMORY_MAX_ITEMS,WORKER_CALL_ID,hasProp={}.hasOwnProperty,slice=[].slice;MEMORY_MAX_ITEMS=10,MEMORY_KEYS_KEY="inputmemory_keys",WORKER_CALL_ID=1,window.I={get_worker:function(){var e;return e=$.Deferred(),I.get_worker=function(){return e},e.resolve(new Worker("/static/worker.min.js")),e},solve_challenge:function(e){return I.get_worker().then(function(t){var r,n,i;return r=WORKER_CALL_ID++,t.postMessage([r,"solve_challenge",e]),n=$.Deferred(),t.addEventListener("message",i=function(o){return function(a){var u,s,l;if(s=a.data,u=s[0],l=s[1],u===r)return t.removeEventListener("message",i),n.resolve(l)}}(this)),n})},libs:{react:$.Deferred(function(e){if(typeof React!="undefined"&&React!==null)return e.resolve(React)}),selectize:$.Deferred(function(e){var t;if(typeof $!="undefined"&&$!==null&&(t=$.fn)!=null&&t.selectize)return e.resolve($.fn.selectize)}),redactor:$.Deferred(function(e){var t;if(typeof $!="undefined"&&$!==null&&(t=$.fn)!=null&&t.redactor)return e.resolve($.fn.redactor)})},setup_page:function(){return I.setup_register_referrers($(document.body)),_.defer(function(e){return function(){return I.setup_affiliate_code()}}(this))},root_url:function(){var e;return e=null,function(t){return e||(e=$("body").data("host")||"",e!==""&&(e=window.location.protocol+"//"+e,window.location.port&&window.location.port!=="80"&&(e+=":"+window.location.port))),e+"/"+t}}(),page_name:function(){return $(document.body).data("page_name")||"unknown"},sort_keys:function(e){var t,r;return r=[],t=function(n){var i,o,a;o=[];for(i in n)hasProp.call(n,i)&&(a=n[i],r.push(i),typeof a=="object"?o.push(t(a)):o.push(void 0));return o},t(e),r.sort()},get_csrf:function(){return I._csrf_token||(I._csrf_token=$("meta[name='csrf_token']").attr("value"))},with_csrf:function(e){var t;return e==null&&(e={}),t={csrf_token:I.get_csrf()},typeof e=="string"?e+"&"+$.param(t):$.extend(e,t)},add_params:function(e,t){var r;return r=$.param(t),e.match(/\?/)?e+"&"+r:e+"?"+r},flash:function(e,t){return t==null&&(t="notice"),I.flasher||(I.flasher=new I.Flasher),e.match(/^error:/)&&(e=e.replace(/^error:/,"Error: "),t="error"),I.flasher.show(t,e)},slugify:function(e,t){return e=e.replace(/\s+/g,"-"),e=t!=null&&t.for_tags?e.replace(/[^\w_.-]/g,"").replace(/^[_.-]+/,"").replace(/[_.-]+$/,""):e.replace(/[^\w_-]/g,""),e.toLowerCase()},truncate:function(e,t,r){return t==null&&(t=30),r==null&&(r="..."),e?e.length>t+r.length?""+e.slice(0,t)+r:e:""},number_format:function(e,t,r,n){var i,o,a;return r==null&&(r="."),n==null&&(n=","),isNaN(e)||e===null?"":(e=e.toFixed(~~t),a=e.split("."),o=a[0],i=a[1]?r+a[1]:"",o.replace(/(\d)(?=(?:\d{3})+$)/g,"$1"+n)+i)},format_bytes:function(){var e;return e=[["gb",Math.pow(1024,3)],["mb",Math.pow(1024,2)],["kb",1024]],function(t){var r,n,i,o,a;for(r=0,i=e.length;r<i;r++)if(a=e[r],n=a[0],o=a[1],t>=o)return""+I.number_format(t/o)+n;return I.number_format(t)+" bytes"}}(),ecommerce_event:function(e){return window.ga?(ga("ecommerce:addTransaction",e.transaction),ga("ecommerce:addItem",e.item),ga("ecommerce:send")):console.log("ecommerce event:",e)},event:function(e,t,r,n,i){var o;return i==null&&(i=!0),o={hitType:"event",eventCategory:e,eventAction:t,eventLabel:r,eventValue:n},i||(o.nonInteraction=1),I.event_with_opts(o)},event_with_opts:function(e){try{return typeof ga!="undefined"&&ga!==null?ga("send",e):(console.log("event:",e),typeof e.hitCallback=="function"?e.hitCallback():void 0)}catch(t){}},event2:function(){var e;e=1<=arguments.length?slice.call(arguments,0):[]},parse_money:function(e){var t;return t=e&&parseInt(e.replace(/[^\d]/g,""),10),t||0},currency_symbols:{USD:"$",GBP:"\xA3",EUR:"\u20AC",JPY:"\xA5"},currency_formats:{USD:{prefix:"$"},GBP:{prefix:"\xA3"},JPY:{prefix:"\xA5"},EUR:{suffix:"\u20AC"}},format_money:function(e,t){var r,n;return t==null&&(t="USD"),e<0?"-"+I.format_money(-e,t):(n=I.currency_symbols[t]||"$",t==="JPY"?n+e:(r=I.number_format(e/100,2),t==="EUR"?""+r+n:""+n+r))},money_input:function(e,t){var r,n;return t==null&&(t={}),e=$(e),r=t.currency||e.data("currency"),n=I.currency_formats[r]||{prefix:"$"},e.maskMoney($.extend({affixesStay:!0,precision:r==="JPY"?0:2},n,t))},plural:function(e,t){return t===1?t+" "+e:t+" "+e+"s"},add_recaptcha_if_necessary:function(e,t){if(t[0]==="recaptcha")return e.data("adding_recaptcha")||(e.data("adding_recaptcha",!0),I.with_recaptcha(function(){var r;return r=e.find(".g-recaptcha"),I.event("recaptcha","show",I.page_name()),grecaptcha.render(r[0],{sitekey:r.data("sitekey")})})),e.set_form_errors(["Please fill out the CAPTCHA to continue"]),!0},with_recaptcha:function(e){var t;return window.grecaptcha?e():I.recaptcha_deferred?I.recaptcha_deferred.done(e):(I.recaptcha_deferred=$.Deferred().done(e),window._itch_recaptcha_loaded=function(){return I.recaptcha_deferred.resolve()},t="https://www.google.com/recaptcha/api.js?onload=_itch_recaptcha_loaded&render=explicit",$('<script type="text/javascript">').attr("src",t).appendTo("head"))},wait_for_object:function(e,t,r){var n,i,o;return i=1,n=10,o=function(){return e[t]?typeof r=="function"?r():void 0:(i+=n,i=Math.min(500,i),setTimeout(o,i))},o()},with_selectize:function(e){return I.libs.selectize.done(e)},get_template:function(e){return _.template($("#"+e+"_tpl").html())},lazy_template:function(e,t){return function(){var r,n;return r=1<=arguments.length?slice.call(arguments,0):[],n=I.get_template(t),e.prototype.template=n,n.apply(null,r)}},setup_sticky_bar:function(e){var t,r,n;return n=$(window),t=$(document.body),e=$(e),r=!1,n.on("scroll",function(i){if(n.scrollTop()>e.offset().top+e.outerHeight()){if(!r)return t.addClass("show_sticky_bar"),r=!0}else if(r)return t.removeClass("show_sticky_bar"),r=!1})},setup_selectize:function(e){return e.find(".selectize_input").each(function(t,r){var n,i,o,a,u,s,l;if(n=$(r),!n.hasClass("selectized"))return u={plugins:[],persist:!1},n.is("select")&&(i={},n.find("option").each(function(c,f){var d;return d=$(f),i[d.val()]=d.data("extra")}),l=function(c,f){var d,p;return d=f(c.text),(p=i[c.value])&&(d=d+" <span class='sub'>\u2014 "+p+"</span>"),"<div class='option'>"+d+"</div>"},u.render={item:l,option:l}),(s=n.data("placeholder"))&&(u.placeholder=s),n.hasClass("dropdown")&&(u.maxItems=1),(a=n.data("options"))&&(n.hasClass("options_object")?(u.options=a,u.searchField=["text","keywords"]):u.options=a.map(function(c){return{value:c[0],text:c[1]}}),u.plugins.push("remove_button"),u.delimiter=",",u.persist=!1),(o=n.data("optgroups"))&&(u.optgroups=o),n.selectize(u)})},format_filesize:function(e,t){var r,n,i,o,a;for(t==null&&(t=".file_size_value"),o=e.find(t),a=[],n=0,i=o.length;n<i;n++)r=o[n],r=$(r),a.push(r.html(I.format_bytes(parseInt(r.html()))));return a},adjust_font_size_to_fit:function(e,t){var r,n,i;if(t==null&&(t=16),!!e.length){for(n=e.css("font-size"),n=parseInt(n.match(/\d+/),10),r=e[0],i=[];r.offsetWidth<r.scrollWidth&&(n-=2,!(n<t));)i.push(e.css("font-size",n+"px"));return i}},slug_input:function(e,t){var r;if(r=/[a-z_0-9_-]/g,e.on("keypress",function(n){var i;if(n.keyCode>=32&&(i=String.fromCharCode(n.keyCode),!i.match(r)))return!1}),t&&t.length)return e.on("change",function(n){var i;if(i=I.slugify(t.val()),e.val().match(/^\s*$/)&&i!=="")return e.val(i)}),t.on("change",function(n){if(e.val().match(/^\s*$/))return e.val(I.slugify($(n.currentTarget).val()))})},deferred_links:function(e,t,r){return r||(r=I.delegate_tracking),e.on("mouseup",t,function(n){var i;if(n.which===2)return i=$(n.currentTarget),r(i,n)}),e.on("click",t,function(n){var i,o,a,u;if(n.which===1&&(u=$(n.currentTarget),o=n.metaKey||n.ctrlKey||n.shiftKey||u.attr("target")==="_blank",i=null,o||(i=function(){if(i)return i=null,window.location=u.attr("href")},setTimeout(function(){return typeof i=="function"?i():void 0},200)),(a=r(u,n))!=null&&a.done(i),!o))return!1})},delegate_tracking:function(e){var t;return t=[],e.trigger("i:delegate_tracking",[function(r){return t.push(r)}]),$.when.apply($,t)},ga_tracker:function(e,t,r,n){var i;return i=function(o){var a,u,s,l,c;return a={hitType:"event",eventCategory:(u=o.data("category"))!=null?u:e,eventAction:(s=o.data("action"))!=null?s:t,eventLabel:(l=o.data("label"))!=null?l:r,eventValue:(c=o.data("value"))!=null?c:n},$.Deferred(function(f){return a.hitCallback=function(){return f.resolve()},I.event_with_opts(a)})}},tracked_links:function(){var e,t,r,n,i,o,a;return r=arguments[0],i=2<=arguments.length?slice.call(arguments,1):[],t=i[0],e=i[1],n=i[2],a=i[3],o=I.ga_tracker(t,e,n,a),I.deferred_links(r,"a[data-label]",o),r.on("i:track_link",function(u,s){var l;return s&&(l=s[0]),I.ga_tracker(t,e,l!=null?l:n,a)($(u.target))})},set_cookie:function(e,t,r){return r==null&&(r={}),I.in_dev&&console.log("set cookie:",[e,t],r),Cookies.set(e,t,$.extend({path:"/",domain:"."+$(document.body).data("host")},r))},set_register_referrer:function(e){var t;if(t=I.page_name(),t!=null&&I.set_cookie("ref:register:page_params",t),e!=null)return I.set_cookie("ref:register:action",e)},setup_register_referrers:function(e){if(!I.current_user)return e.on("mouseup","[data-register_action]",function(t){var r;return r=$(t.currentTarget).data("register_action"),I.set_register_referrer(r)})},setup_affiliate_code:function(e,t){var r,n;if(t==null&&(t=!1),e==null&&(e=(n=window.location.search.match(/\bac=([\w\d]+(?:\-[\.:_\w\d]+)?)/))!=null?n[1]:void 0),!!e&&!(!t&&e===Cookies.get("acode")))return I.set_cookie("acode",e,{expires:1}),document.referrer&&I.set_cookie("acode:ref",document.referrer.substring(0,180),{expires:1}),r=window.location.href.replace(/\?.*$/,"").substring(0,180),I.set_cookie("acode:land",r,{expires:1})},bind_checkbox_to_input:function(e,t,r){var n;return n=function(){var i;return i=e.prop("checked"),t.prop("disabled",i),typeof r=="function"?r(i):void 0},e.on("change",n),n()},add_facebook:function(e){var t,r,n;if(!window.FB&&(I.add_facebook=function(){},$('<div id="fb-root"></div>').appendTo(document.body),r="facebook-jssdk",!document.getElementById(r)))return e!=null&&(window.fbAsyncInit=e),t=document.getElementsByTagName("script")[0],n=document.createElement("script"),n.id=r,n.src="//connect.facebook.net/en_GB/sdk.js#xfbml=1&appId=537395183072744&version=v2.0",t.parentNode.insertBefore(n,t)},add_twitter:function(){var e,t,r;if(t="twitter-wjs",!document.getElementById(t))return I.add_twitter=function(){},e=document.getElementsByTagName("script")[0],r=document.createElement("script"),r.id="twitter-wjs",r.src="//platform.twitter.com/widgets.js",e.parentNode.insertBefore(r,e)},add_react:function(){var e,t;return e=$.Deferred(),window.ReactDOM?(e.resolve(),e):(I.add_react=function(){return e},I.libs.react.done(function(){return e.resolve()}),t=$("#lib_react_src"),t.replaceWith($('<script type="text/javascript">').attr("src",t.data("src"))),e)},has_follow_button:function(e,t){var r,n,i,o,a,u,s;return t==null&&(t={}),e=$(e),i=(a=t.cls)!=null?a:"follow_button_widget",r=(u=t.animate_follow)!=null?u:"animate_bounce",n=(s=t.animate_unfollow)!=null?s:"animate_drop_down",o={},o[i]=function(l){var c,f,d,p;if(!I.current_user)return"continue";if(!l.is(".loading"))return l.removeClass(r+" "+n),d=$.Deferred(function(g){return setTimeout(function(){return g.resolve()},500)}),f=l.is(".is_following"),p=f?(_.defer(function(){return l.addClass(n)}),l.data("unfollow_url")):(_.defer(function(){return l.addClass(r)}),l.data("follow_url")),l.addClass("loading").trigger("i:track_link",["follow_btn"]),c=l.data("follow_data")||{},$.when($.post(p,I.with_csrf(c)),d).done(function(g){var y;if(y=g[0],l.removeClass("loading "+r+" "+n),y.errors){I.flash(y.errors.join(", "));return}return l.toggleClass("is_following",y.following).trigger("i:follow_updated",[{user_id:l.data("user_id"),following:y.following,btn:l}])})},e.dispatch("click",o),$(document.body).on("i:follow_updated",function(l,c){var f,d,p;return p=c.user_id,d=c.following,f=c.btn,e.find("."+i+"[data-user_id="+p+"]").not(f).toggleClass("is_following",d)})},is_mobile:function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},is_ios:function(){return/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream},strip_css:function(e){return e.replace(/<\s*\/\s*style\s*>/i,"")},request_fullscreen:function(e,t){var r,n,i;return r=e.requestFullscreen?(e.requestFullscreen(),!0):e.msRequestFullscreen?(e.msRequestFullscreen(),!0):e.mozRequestFullScreen?(e.mozRequestFullScreen(),!0):e.webkitRequestFullscreen?(e.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT),!0):!1,r&&t&&(n=window.screen)!=null&&(i=n.orientation)!=null&&typeof i.lock=="function"&&i.lock(t),r},is_fullscreen:function(){return!(!document.fullscreenElement&&!document.mozFullScreenElement&&!document.webkitFullscreenElement&&!document.msFullscreenElement)},exit_fullscreen:function(){if(document.exitFullscreen)return document.exitFullscreen();if(document.msExitFullscreen)return document.msExitFullscreen();if(document.mozCancelFullScreen)return document.mozCancelFullScreen();if(document.webkitExitFullscreen)return document.webkitExitFullscreen()},toggle_fullscreen:function(e,t){return I.is_fullscreen()?(I.exit_fullscreen(),!1):I.request_fullscreen(e,t)?!0:"failed"},setup_dirty_warning:function(e,t){return t||(t=function(){return e.data("dirty")}),e.data("dirty",!1),$(window).on("beforeunload",function(){var r;if(r=t(),!!r)switch(typeof r){case"string":return r;default:return"You've made modifications to this page."}}),e.on("i:after_submit",function(){return e.data("dirty",!1)}),_.defer(function(){return e.on("change","input, select, textarea",function(r){return e.data("dirty",!0)}),e.on("keydown, mousedown",".redactor-editor",function(){return e.data("dirty",!0)})})},remote_submit:function(e,t,r){var n,i;return r==null&&(r={}),e.trigger("i:before_submit"),r.loading_lock&&(i=e.serializeArray(),n=e.addClass("loading").find("button, input[type='submit']").prop("disabled",!0).addClass("disabled")),$.when(t).then(function(o){var a;return i||(i=e.serializeArray()),o&&(i=i.concat(o)),$.ajax({data:i,type:(a=e.attr("method"))!=null?a:"POST",dataType:"json",url:e.attr("action"),xhrFields:{withCredentials:!0},error:function(u){var s;return s=function(){try{return JSON.parse(u.responseText)}catch(l){}}(),s!=null&&s.errors?I.flash(s.errors.join(", ")):I.flash("We seem to be having server problems right now! Please try again later.")},complete:function(){return r.loading_lock&&(n.prop("disabled",!1).removeClass("disabled"),e.removeClass("loading")),e.trigger("i:after_submit")}}).then(null,function(u){try{return JSON.parse(u.responseText)}catch(s){throw u}})})},is_middle_click:function(e){return e.which===2||e.metaKey||e.ctrlKey},escape_regex:function(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")},move:function(e,t,r){var n,i,o,a;if(i=e.indexOf(t),i===-1)throw"Failed to find object in array";if(a=i+r,a<0||a>=e.length)throw"Movement is outside of array ("+a+") [0, "+(e.length-1)+"]";return n=function(){var u,s,l;for(l=[],u=0,s=e.length;u<s;u++)o=e[u],o!==t&&l.push(o);return l}(),n.splice(a,0,t),n},format_integer:function(e){return e>1e7?Math.floor(e/1e6)+"m":e>=1e6?Math.floor(e/1e5)/10+"m":e>1e4?Math.floor(e/1e3)+"k":e>=1e3?Math.floor(e/100)/10+"k":""+e},store_memory:function(e,t){var r,n,i,o;if(window.localStorage){if(i=function(){try{return JSON.parse(localStorage.getItem(MEMORY_KEYS_KEY))}catch(a){}}(),i||(i=[]),i[0]!==e){for(n=function(){var a,u,s;for(s=[],a=0,u=i.length;a<u;a++)r=i[a],e!==r&&s.push(r);return s}(),i=[e].concat(n);i.length>MEMORY_MAX_ITEMS;)o=i.pop(),typeof localStorage!="undefined"&&localStorage!==null&&localStorage.removeItem(o);localStorage.setItem(MEMORY_KEYS_KEY,JSON.stringify(i))}return localStorage.setItem(e,t)}},clear_memory:function(e){var t,r;if(window.localStorage){r=function(){try{return JSON.parse(localStorage.getItem(MEMORY_KEYS_KEY))}catch(n){}}(),r&&localStorage.setItem(MEMORY_KEYS_KEY,JSON.stringify(function(){var n,i,o;for(o=[],n=0,i=r.length;n<i;n++)t=r[n],e!==t&&o.push(t);return o}()));try{return localStorage.removeItem(e)}catch(n){}}}},$(function(){var e;if((e=window.location.hash.match(/\bflash=([^&]*)/))&&(I.flash(e[1]),window.location.hash=window.location.hash.replace(/\bflash=([^&]*)/,"")),I.ie)return $(document.body).addClass("ie")}),I.Flasher=function(){e.prototype.duration=1e4,e.prototype.animation_duration=250,e.prototype.clipping="-7px";function e(){$(document).on("click",".global_flash",function(t){return function(){return t.dismiss()}}(this))}return e.prototype.dismiss=function(){var t;if(t=this.current_flash)return this.timeout&&(clearTimeout(this.timeout),this.timeout=null),t.css({"margin-top":"-"+(t.outerHeight()+4)+"px"}),setTimeout(function(r){return function(){return t.remove()}}(this),this.animation_duration*2)},e.prototype.show=function(t,r){var n;return this.dismiss(),n=$("<div class='global_flash "+t+"' role='alert' aria-live='polite'>").text(r).appendTo("body"),n.css({"margin-left":"-"+n.width()/2+"px","margin-top":"-"+(n.outerHeight()+4)+"px"}),this.timeout=setTimeout(function(i){return function(){return n.addClass("animated"),n.css({"margin-top":i.clipping}),setTimeout(function(){return i.dismiss()},i.duration)}}(this),100),this.current_flash=n},e}(),_.templateSettings={escape:/\{\{(?![&])(.+?)\}\}/g,interpolate:/\{\{&(.+?)\}\}/g,evaluate:/<%([\s\S]+?)%>/g},$.easing.smoothstep=function(e){return e*e*e*(e*(e*6-15)+10)};var dayjs,dayjs_default=dayjs=window.dayjs;window._dayjs_setup||(dayjs.extend(window.dayjs_plugin_duration),dayjs.extend(window.dayjs_plugin_calendar),dayjs.extend(window.dayjs_plugin_advancedFormat),dayjs.extend(window.dayjs_plugin_relativeTime),window._dayjs_setup=!0);var coerce_timestamp,slice2=[].slice;coerce_timestamp=function(e){var t;return(t=typeof e=="string"&&e.match(/(^\d{4}\-\d{1,2}\-\d{1,2}) (\d{1,2}:\d{1,2}:\d{1,2})$/))?t[1]+"T"+t[2]+"Z":e};var format_timestamp=function(){var e,t,r,n;switch(n=arguments[0],t=arguments[1],e=3<=arguments.length?slice2.call(arguments,2):[],t==null&&(t="fromNow"),n=coerce_timestamp(n),t){case"fromNow":return dayjs_default(n).fromNow();case"calendar":return dayjs_default(n).calendar(null,{sameElse:"MMMM Do YYYY"});case"format":return(r=dayjs_default(n)).format.apply(r,e);default:throw new Error("unknown method for format_timestamp: "+t)}},show_images;$.fn.dispatch=function(e,t){return this.on(e,function(r){return function(n){var i,o,a,u;for(a in t)if(o=t[a],i=$(n.target).closest("."+a),!!i.length)return i.is(".disabled")?!1:i.is("a")&&n.ctrlKey||(u=o(i,n),u==="continue")?void 0:!1;return null}}(this)),this},$.fn.exists=function(){return this.length>0?this:!1},$.fn.format_timestamps=function(e){var t,r,n,i,o;for(e==null&&(e="calendar"),o=this.find(".date_format"),r=function(a){var u,s,l;return u=a.data("format"),s=a.html(),l=u?format_timestamp(s,"format",u):format_timestamp(s,e),a.html(l).attr("title",s+" UTC")},n=0,i=o.length;n<i;n++)t=o[n],r($(t));return this},$.fn.has_tooltips=function(e){var t,r,n,i,o,a;if(e==null&&(e={}),!I.is_mobile())return o=function(){var u;return u=$('<div class="tooltip_drop"></div>'),$(document.body).append(u),o=function(){return u},u},a=_.template('<div class="tooltip">{{ label }}</div>'),i=function(u,s){var l,c,f,d;return s==null&&(s=!1),l=u.data("tooltip_el"),l||(l=$(a({label:u.attr("aria-label")||u.data("tooltip")})),u.data("tooltip_el",l)),l.removeClass("visible"),o().empty().append(l),f=u.offset(),c=l.outerHeight(),d=l.outerWidth(),l.css({position:"absolute",top:e.below?f.top+u.outerHeight()+10:f.top-c-10,left:Math.floor(f.left+(u.outerWidth()-d)/2)}),l.toggleClass("below",!!e.below),s?l.addClass("visible"):setTimeout(function(p){return function(){return l.addClass("visible")}}(this),10)},r=function(u){return function(s){var l,c;if(c=$(s.currentTarget),l=c.data("tooltip_el"),c.removeData("tooltip_el"),!!l&&l.is(":visible"))return i(c,!0)}}(this),n=function(u){return function(s){var l;if(l=$(s.currentTarget),!l.closest(".redactor-box").length)return i(l)}}(this),t=function(u){return function(s){var l,c;if(c=$(s.currentTarget),l=c.data("tooltip_el"))return l.remove()}}(this),this.is("[data-tooltip]")?(this.on("i:refresh_tooltip",r),this.on("mouseenter focus",n),this.on("mouseleave blur i:hide_tooltip",t)):(this.on("i:refresh_tooltip","[data-tooltip], [aria-label]",r),this.on("i:clear_tooltips",function(){return o().empty()}),this.on("mouseenter focus","[data-tooltip], [aria-label]",n),this.on("mouseleave blur i:hide_tooltip","[data-tooltip], [aria-label]",t)),this},$.fn.inline_edit=function(e){var t,r,n;if(e==null&&(e={}),this.is(".inline_editing")){this.data("finished_editing")();return}return this.addClass("inline_editing"),r=$('<input type="text" class="inline_edit_input" />').attr("placeholder",this.data("placeholder")).val((typeof e.get_val=="function"?e.get_val(this):void 0)||this.text()).insertAfter(this.hide()).select(),t=function(i){return function(){return r.remove(),i.show(),$(document).off("click.inline_editing"),i.removeClass("inline_editing")}}(this),this.data("finished_editing",t),n=function(i){return function(){return r.prop("disabled",!0),e.set_val?e.set_val(i,r.val(),t):(i.text(r.val()),t())}}(this),$(document).on("click.edit_title",function(i){return function(o){if(!$(o.target).closest(".inline_edit_input").length)return n()}}(this)),r.on("keydown",function(i){return function(o){switch(o.keyCode){case 9:return _.defer(function(){return n()});case 13:return n();case 27:return t()}}}(this))},I.support_passive_scroll=function(){var e,t;t=!1;try{e=Object.defineProperty({},"passive",{get:function(r){return function(){return t=!0}}(this)}),window.addEventListener("test",null,e)}catch(r){}return t},I.support_intersection_observer=function(){return"IntersectionObserver"in window},show_images=function(e,t){var r,n,i,o,a,u,s,l;for(e.removeClass("lazy_images"),n=e.find("[data-background_image]").addBack("[data-background_image]"),o=function(){var c,f,d;for(d=[],c=0,f=n.length;c<f;c++)r=n[c],d.push(function(p){var g;if(p=$(p),g=p.data("background_image"),p.css({backgroundImage:"url("+g+")"}),t)return $.Deferred(function(y){return function(x){return $("<img />").attr("src",g).on("load",function(){return x.resolve()})}}(this))}(r));return d}(),l=e.find("img[data-lazy_src]").addBack("img[data-lazy_src]"),i=function(c){var f,d;if(c=$(c),f=c.data("lazy_src"),c.attr("src",f),(d=c.data("lazy_srcset"))&&c.attr("srcset",d),t)return $.Deferred(function(p){return function(g){return c.on("load",function(){return g.resolve()})}}(this))},u=0,s=l.length;u<s;u++)a=l[u],i(a);if(t)return o.length===1?o[0]:$.when.apply($,o)},$.fn.lazy_images=function(e){var t,r,n,i,o,a,u,s,l,c,f,d,p,g,y,x;if(f=this.data("lazy_images"))return f();if(s=e!=null&&e.elements?function(){var w,v,m,h;for(m=e.elements,h=[],w=0,v=m.length;w<v;w++)n=m[w],h.push($(n));return h}():(d=(e!=null?e.selector:void 0)||".lazy_images",function(){var w,v,m,h;for(m=this.find(d),h=[],w=0,v=m.length;w<v;w++)n=m[w],h.push($(n));return h}.call(this)),t=(c=e!=null?e.show_images:void 0)!=null?c:show_images,I.support_intersection_observer()){for(i=function(w){var v,m,h,b,k,j;for(j=[],h=0,b=w.length;h<b;h++)m=w[h],m.isIntersecting?(n=m.target,a.unobserve(n),n=$(n),k=e!=null?e.show_item:void 0,v=t(n,!!k),j.push(typeof k=="function"?k(n,v):void 0)):j.push(void 0);return j},a=new IntersectionObserver(i,{}),u=0,l=s.length;u<l;u++)n=s[u],a.observe(n[0]);return function(){return a.disconnect()}}return x=$(window),p=e!=null?e.target:void 0,o=e!=null?e.horizontal:void 0,y=null,r=function(w){return function(){var v,m,h,b,k,j,T,E,L;for(v=function(){if(p){if(o)return p.outerWidth()+p.position().left;throw new Error("not yet")}else return x.scrollTop()+x.height()}(),h=0,b=j=0,T=s.length;j<T;b=++j)if(k=s[b],!!k){if(!document.body.contains(k[0])){s[b]=null,h+=1;continue}L=function(){if(p){if(o)return k.position().left;throw new Error("not yet")}else return k.offset().top}(),k[0].offsetParent&&L<v&&(E=e!=null?e.show_item:void 0,m=t(k,!!E),typeof E=="function"&&E(k,m),h+=1,s[b]=null)}if(h>0)return s=function(){var C,q,M;for(M=[],C=0,q=s.length;C<q;C++)n=s[C],n&&M.push(n);return M}()}}(this),g=_.throttle(r,100),p?(p.on("scroll",g),x.on("resize",g),y=function(){return p.off("scroll",g),x.off("resize","throttled")}):I.support_passive_scroll()?(window.addEventListener("scroll",g,{passive:!0}),x.on("resize i:reshape",g),y=function(){return window.removeEventListener("scroll",g,{passive:!0}),x.off("resize",g)}):(x.on("scroll resize i:reshape",g),y=function(){return x.off("scroll resize i:reshape",g)}),this.data("lazy_images",function(w){return function(){return s=e!=null&&e.elements?function(){var v,m,h,b;for(h=e.elements,b=[],v=0,m=h.length;v<m;v++)n=h[v],b.push($(n));return b}():(d=(e!=null?e.selector:void 0)||".lazy_images",function(){var v,m,h,b;for(h=this.find(d),b=[],v=0,m=h.length;v<m;v++)n=h[v],b.push($(n));return b}.call(w)),r()}}(this)),r(),y},$.fn.max_height=function(e){var t,r,n;return e==null&&(e=0),n=$(window),t=this.outerHeight(!0)-this.height(),r=function(i){return function(){return i.css("min-height",n.height()-t-e+"px")}}(this),n.on("resize",r),r()},$.fn.remote_link=function(e){return this.on("click","[data-remote]",function(t){return function(r){var n,i,o,a,u;if(r.preventDefault(),i=$(r.currentTarget),!i.is(".loading")&&(a=i.data("method")||"POST",u=I.with_csrf($.extend({},i.data("params"))),o=i.data("href")||i.attr("href"),!((n=i.data("confirm"))&&!confirm(n))))return i.addClass("loading").prop("disabled",!0),$.ajax({type:a,url:o,data:u,xhrFields:{withCredentials:!0}}).done(function(s){return i.removeClass("loading").prop("disabled",!1),typeof e=="function"?e(s,i):void 0}),null}}(this))},$.fn.remote_submit=function(e,t,r){var n;return n=null,this.on("click","button[name], input[type='submit'][name]",function(i){return function(o){var a;return a=$(o.currentTarget),n!=null&&n.remove(),n=$("<input type='hidden' />").attr("name",a.attr("name")).val(a.attr("value")).prependTo(i)}}(this)),this.on("submit",function(i){return function(o,a){var u;if(o.preventDefault(),u=$(o.currentTarget),!(t&&!(typeof t=="function"&&t(u))))return I.remote_submit(u,r,{loading_lock:!0}).done(function(s){return u.data("dirty",!1),a!=null?a(s,u):e(s,u)}),null}}(this))},$.fn.remote_table=function(){var e,t,r,n;return r=this.data("max_page"),e=function(i){return function(){return i.data("page")||1}}(this),n={},t=function(i){return function(o){var a,u;if(!i.is(".loading")&&1<=o&&o<=r)return a=i.find("table"),i.addClass("loading").data("page",o).toggleClass("first_page",o===1).toggleClass("last_page",o===r).find(".current_page").text(o),u=n[o]||(n[o]=$.get(i.data("remote_url")+"?"+$.param({page:o}))),u.done(function(s){return i.removeClass("loading"),a.html(s.content)})}}(this),this.dispatch("click",{next_page_btn:function(i){return function(){return t(e()+1)}}(this),prev_page_btn:function(i){return function(){return t(e()-1)}}(this)})},$.fn.set_form_errors=function(e,t,r){var n,i,o,a,u,s,l,c;if(t==null&&(t=!0),r==null&&(r="Errors"),this.find(".form_errors").remove(),u=!!(e!=null&&e.length),this.toggleClass("has_errors",u),u){for(o=$(_.template(`<div class="form_errors">
  <div>{{ msg }}:</div>
  <ul></ul>
</div>`)({msg:r})),a=o.find("ul"),s=0,l=e.length;s<l;s++)i=e[s],a.append($("<li></li>").text(i));this.prepend(o),t&&(c=this.closest(".lightbox"),c.length||this.offset().top>$(window).height()/2?typeof(n=this[0]).scrollIntoView=="function"&&n.scrollIntoView():$("html, body").animate({scrollTop:0},"fast"))}return this},$.fn.swap_with=function(e){var t,r,n,i,o,a,u,s;if(e=$(e),!!(this.length&&e.length))return r=this.offset(),i=e.offset(),s=this.prop("tagName"),a=e.prop("tagName"),u=$("<"+s+"></"+s+">").insertAfter(this),o=$("<"+a+"></"+a+">").insertAfter(e),u.after(e),o.after(this),t=this.offset(),n=e.offset(),o.replaceWith(this.detach().css({position:"relative",top:r.top-t.top+"px",left:r.left-t.left+"px"})),u.replaceWith(e.detach().css({position:"relative",top:i.top-n.top+"px",left:i.left-n.left+"px"})),_.defer(function(l){return function(){return l.css({top:"",left:""}),e.css({top:"",left:""})}}(this))},$.fn.track_input=function(e,t){var r,n;return r=this.find(e),n=function(i){return function(){var o,a,u;return u=function(){var s,l,c;for(c=[],s=0,l=r.length;s<l;s++)a=r[s],c.push(t+"_"+$(a).attr("value"));return c}(),i.removeClass(u.join(" ")),o=r.serializeArray().map(function(s){return t+"_"+s.value}),i.addClass(o.join(" "))}}(this),r.on("change",function(i){return n()}),n()};var jQuery,jquery_default=jQuery=window.$,slice3=[].slice,extend=function(e,t){for(var r in t)hasProp2.call(t,r)&&(e[r]=t[r]);function n(){this.constructor=e}return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},hasProp2={}.hasOwnProperty;I.Lightbox&&console.warn("I.Lightbox is being double declared");var Lightbox=I.Lightbox||(I.Lightbox=function(){e.include_dependencies=function(t){var r;return t?(r=[],t.redactor&&!jquery_default.fn.redactor&&(jquery_default("head").append(t.redactor),r.push(I.libs.redactor)),t.selectize&&!jquery_default.fn.selectize&&(jquery_default("head").append(t.selectize),r.push(I.libs.selectize)),r):[]},e.lightbox_container=function(){return this._container||(this._container=jquery_default("#lightbox_container").exists()||jquery_default('<div id="lightbox_container"></div>').appendTo("body"))},e.shroud_container=function(){return this._shroud||(this._shroud=jquery_default("#lightbox_shroud").exists()||jquery_default('<div id="lightbox_shroud"></div>').appendTo("body"))},e.show_shroud=function(){var t;if(!this.shroud_visible)return this._shroud||(t=this.shroud_container(),this.lightbox_container().on("click",function(r){return function(n){if(!jquery_default(n.target).closest(".lightbox").length)return jquery_default(n.target).attr("href")==="javascript:void(0)"?void 0:r.close()}}(this)),t.on("click",function(r){return function(){return r.close()}}(this)),jquery_default(document.body).on("keydown",function(r){return function(n){return n.keyCode===27?(n.preventDefault(),n.stopPropagation(),r.close()):r.on_keydown(n)}}(this)),jquery_default(window).on("resize",function(r){return function(n){return r.on_resize(n)}}(this))),this.shroud_visible=!0,this.shroud_container().addClass("invisible").show(),_.defer(function(r){return function(){return r.shroud_container().removeClass("invisible")}}(this))},e.hide_shroud=function(){return this.shroud_visible=!1,this.shroud_container().hide()},e.open_loading=function(){return this.open_tpl("loading_lightbox")},e.open_remote_react=function(t,r){return this.open_loading(),jquery_default.when(I.add_react(),jquery_default.ajax({dataType:"json",url:t,data:{props:!0},xhrFields:{withCredentials:!0},error:function(n){return function(i,o,a){var u,s,l;return l=function(){try{return JSON.parse(i.responseText)}catch(c){}}(),u=(s=l!=null?l.errors:void 0)!=null?s:["Something went wrong. Please try again later and contact support if it persists."],R.ErrorLightbox?I.Lightbox.open(R.ErrorLightbox({errors:u})):(alert(u.join(",")),n.close())}}(this)})).done(function(n){return function(i,o){var a,u;if(u=o[0],u.errors){R.ErrorLightbox?I.Lightbox.open(R.ErrorLightbox(u)):(alert(u.errors.join(",")),n.close());return}return a=I.Lightbox.include_dependencies(u._dependencies),jquery_default.when.apply(jquery_default,[r(u)].concat(slice3.call(a))).then(function(s){return s?I.Lightbox.open(s):n.close()})}}(this))},e.open_remote=function(){var t,r,n;return n=arguments[0],t=arguments[1],r=3<=arguments.length?slice3.call(arguments,2):[],t==null&&(t=I.Lightbox),this.open_loading(),jquery_default.ajax({dataType:"json",url:n,data:{lightbox:!0},xhrFields:{withCredentials:!0},success:function(i){return function(o){if(o.errors){alert(o.errors.join(",")),i.close();return}return i.open.apply(i,[o.content,t].concat(slice3.call(r)))}}(this),error:function(i){return function(o,a,u){return alert("Something went wrong. Please try again later and contact support if it persists."),i.close()}}(this)})},e.open_tpl=function(){var t,r,n;if(n=arguments[0],t=2<=arguments.length?slice3.call(arguments,1):[],r=jquery_default("#"+n+"_tpl"),!r.length)throw"missing template for lightbox: "+n;return this.open.apply(this,[r.html()].concat(slice3.call(t)))},e.open_tpl_with_params=function(){var t,r,n,i,o;if(o=arguments[0],i=arguments[1],t=3<=arguments.length?slice3.call(arguments,2):[],r=jquery_default("#"+o+"_tpl"),!r.length)throw"missing template for lightbox: "+o;return n=_.template(r.html())(i),this.open.apply(this,[n].concat(slice3.call(t)))},e.open=function(){var t,r,n,i,o,a;return n=arguments[0],t=arguments[1],r=3<=arguments.length?slice3.call(arguments,2):[],t==null&&(t=I.Lightbox),this.current_lightbox&&(this.current_lightbox.close(),this.current_lightbox=null),a=!1,n.$$typeof?(a=!0,i=new I.ReactLightbox(n,this)):(typeof n=="string"&&(n=jquery_default.trim(n)),o=jquery_default(n),(i=o.data("object"))||(a=!0,i=function(u,s,l){l.prototype=u.prototype;var c=new l,f=u.apply(c,s);return Object(f)===f?f:c}(t,[o,this].concat(slice3.call(r)),function(){}),o.data("object",i))),jquery_default(document.body).addClass("lightbox_open"),this.show_shroud(),i.show(a),this.current_lightbox=i,i},e.close=function(){var t;if(!(this.current_lightbox&&!this.current_lightbox.is_closable())&&!(this.current_lightbox&&this.current_lightbox.el.is(".has_changes")&&!confirm("You've have unsaved changes in this dialog. Are you sure you want to close it?")))return this.hide_shroud(),(t=this.current_lightbox)!=null&&t.close(),this.current_lightbox=null,jquery_default(document.body).removeClass("lightbox_open")},e.on_keydown=function(t){var r,n;return(r=this.current_lightbox)!=null&&(n=r.el)!=null?n.trigger("i:lightbox_keydown",t):void 0},e.on_resize=function(t){var r,n;return(r=this.current_lightbox)!=null&&(n=r.el)!=null?n.trigger("i:lightbox_resize",t):void 0};function e(){var t,r,n;t=arguments[0],r=arguments[1],n=3<=arguments.length?slice3.call(arguments,2):[],this.parent=r,this.el=jquery_default(t),this.el.data("lightbox",this),this.el.on("click",".close_button, .close_btn",function(i){return function(o){return I.Lightbox.close(),!1}}(this)),this.init.apply(this,n)}return e.prototype.init=function(){},e.prototype.first_show=function(){},e.prototype.with_selectize=function(t){var r;if(!jquery_default.fn.selectize){if(r=this.el.data().selectize,!r)throw"missing selectize include in lightbox";jquery_default("head").append(r)}return I.with_selectize(t)},e.prototype.with_redactor=function(t){var r;if(!jquery_default.fn.redactor){if(r=this.el.data().redactor,!r)throw"missing redactor include in lightbox";jquery_default("head").append(r)}return I.libs.redactor.done(t)},e.prototype.show=function(t){if(this.el.appendTo(this.parent.lightbox_container()).addClass("animated").show().trigger("i:lightbox_open"),this.position(),t)return this.first_show()},e.prototype.close=function(){return this.el.removeClass("animated").hide().trigger("i:lightbox_close").remove()},e.prototype.position=function(){var t;return t=this.parent.lightbox_container().css("position")==="fixed"?"":jquery_default(window).scrollTop()+"px",this.el.css({top:t})},e.prototype.closable=!0,e.prototype.is_closable=function(){return this.closable},e}()),ReactLightbox=I.ReactLightbox||(I.ReactLightbox=function(e){extend(t,e);function t(){var r,n,i,o,a,u;r=arguments[0],i=arguments[1],a=3<=arguments.length?slice3.call(arguments,2):[],u=jquery_default('<div class="react_lightbox"></div>').appendTo(i.lightbox_container()),o=ReactDOM.render(r,u[0]),n=ReactDOM.findDOMNode(o),t.__super__.constructor.apply(this,[n,i].concat(slice3.call(a)))}return t.prototype.show=function(r){return this.el.addClass("animated"),this.position()},t.prototype.close=function(){var r;return this.el.trigger("i:lightbox_close"),r=this.el.parent(),ReactDOM.unmountComponentAtNode(r[0]),r.remove()},t}(I.Lightbox)),I2=window.I,_hex_piece,hex_color,hsl_to_rgb,luma,mix_color,parse_color,parse_color_safe,readable_text_color,relative_luma,rgb_helper,rgb_to_hsl,rgb_to_yuv,scale_luma,sub_color,sub_color2,yuv_to_rgb,slice4=[].slice;rgb_helper=function(e,t,r){return e<0?e+=1:e>1&&(e-=1),6*e<1?t+(r-t)*6*e:2*e<1?r:3*e<2?t+(r-t)*(2/3-e)*6:t},hsl_to_rgb=function(e,t,r){var n,i,o,a,u;return e=e/360,t=t/100,r=r/100,t===0?(o=r,i=r,n=r):(u=r<.5?r*(1+t):r+t-r*t,a=2*r-u,o=rgb_helper(e+1/3,a,u),i=rgb_helper(e,a,u),n=rgb_helper(e-1/3,a,u)),[o*255,i*255,n*255]},rgb_to_hsl=function(e,t,r){var n,i,o,a,u;return e=e/255,t=t/255,r=r/255,a=Math.min(e,t,r),o=Math.max(e,t,r),u=0,n=0,i=(a+o)/2,a!==o&&(u=i<.5?(o-a)/(o+a):(o-a)/(2-o-a),n=function(){switch(o){case e:return(t-r)/(o-a);case t:return 2+(r-e)/(o-a);case r:return 4+(e-t)/(o-a)}}()),n<0&&(n+=6),[n*60,u*100,i*100]},parse_color=function(){var e,t,r,n,i,o,a,u,s,l,c;if(l=arguments[0],u=2<=arguments.length?slice4.call(arguments,1):[],n="[a-fA-f0-9]",i=n+n,c="^#("+n+")("+n+")("+n+")$",s="^#("+i+")("+i+")("+i+")$",o=l.match(new RegExp(c)),o)e=o[0],a=o[1],r=o[2],t=o[3],a+=a,r+=r,t+=t;else{if(o=l.match(new RegExp(s)),!o)return null;e=o[0],a=o[1],r=o[2],t=o[3]}return[parseInt(a,16),parseInt(r,16),parseInt(t,16)]},parse_color_safe=function(){var e;return e=parse_color.apply(null,arguments),e||[0,0,0]},_hex_piece=function(e){var t;return t=Math.floor(e).toString(16),t.length===1?"0"+t:t},hex_color=function(e,t,r){return e=Math.min(255,Math.max(0,e)),t=Math.min(255,Math.max(0,t)),r=Math.min(255,Math.max(0,r)),"#"+_hex_piece(e)+_hex_piece(t)+_hex_piece(r)},sub_color=function(e,t,r){var n,i,o,a,u;return t==null&&(t=15),r==null&&(r=.8),a=rgb_to_hsl.apply(null,parse_color_safe(e)),n=a[0],u=a[1],i=a[2],o=i>50?i-t:i+t,o=Math.max(0,Math.min(100,o)),hex_color.apply(null,hsl_to_rgb(n,u*r,o))},luma=function(e,t,r){return(.299*e+.587*t+.114*r)/255},relative_luma=function(e,t,r){return e=e/255,t=t/255,r=r/255,e=e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4),t=t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4),r=r<=.03928?r/12.92:Math.pow((r+.055)/1.055,2.4),.2126*e+.7152*t+.0722*r},rgb_to_yuv=function(e,t,r){var n,i,o;return o=.299*e+.587*t+.114*r,n=(r-o)*.565,i=(e-o)*.713,[o,n,i]},yuv_to_rgb=function(e,t,r){var n,i,o;return o=e+1.403*r,i=e-.344*t-.714*r,n=e+1.77*t,[o,i,n]},scale_luma=function(e,t,r,n){var i,o,a,u;return n==null&&(n=.1),i=rgb_to_yuv(e,t,r),u=i[0],o=i[1],a=i[2],n<0?u+=n*u:u+=n*(255-u),yuv_to_rgb(u,o,a)},readable_text_color=function(e,t,r){var n,i;return typeof e=="string"&&(n=parse_color_safe(e),e=n[0],t=n[1],r=n[2]),i=relative_luma(e,t,r),i>=.45?mix_color(hex_color(e,t,r),"#000000",.2):"#ffffff"},sub_color2=function(e,t,r){var n,i,o,a,u;return t==null&&(t=.15),r==null&&(r=.5),u=parse_color_safe(e),a=u[0],i=u[1],n=u[2],o=luma(a,i,n),o<r?hex_color.apply(null,scale_luma(a,i,n,t)):hex_color.apply(null,scale_luma(a,i,n,-t))},mix_color=function(e,t,r){var n,i,o,a,u,s,l,c,f;return r===1?e:r===0?t:(c=parse_color_safe(e),s=c[0],a=c[1],i=c[2],f=parse_color_safe(t),l=f[0],u=f[1],o=f[2],n=1-r,hex_color(s*r+l*n,a*r+u*n,i*r+o*n))};var Color=I2.Color||(I2.Color={hsl_to_rgb,rgb_to_hsl,parse_color,parse_color_safe,hex_color,sub_color,luma,relative_luma,rgb_to_yuv,yuv_to_rgb,scale_luma,readable_text_color,sub_color2,mix_color}),_2=window._,UNKNOWN_IMAGE_FORMAT_ERROR,image_type_from_array_buffer,bind=function(e,t){return function(){return e.apply(t,arguments)}},extend2=function(e,t){for(var r in t)hasProp3.call(t,r)&&(e[r]=t[r]);function n(){this.constructor=e}return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},hasProp3={}.hasOwnProperty,catch_server_error=function(e){return e.then(null,function(t){return $.Deferred().reject({errors:["Server error ("+t.status+")","Please contact support if the error persists"]})})};I.prepare_upload=function(e,t){return $.when(t).then(function(r){return catch_server_error($.ajax({url:e+"/upload/prepare",type:"post",data:I.with_csrf(r),dataType:"json"})).then(function(n){return n.errors?$.Deferred().reject(n):n})})},image_type_from_array_buffer=function(e){var t,r,n,i,o;return t=new DataView(e,0,5),n=t.getUint8(0,!0),i=t.getUint8(1,!0),r=n.toString(16)+i.toString(16),o={8950:"image/png",4749:"image/gif","424d":"image/bmp",ffd8:"image/jpeg"},o[r]},UNKNOWN_IMAGE_FORMAT_ERROR="You selected an image type we don't recognize. It's possible it has the wrong file extension for the format it is saved as. Please use an image editing program to convert it to a PNG, JPEG, or GIF.",I.test_image_format=function(e){return $.Deferred(function(t){return function(r){var n;return window.FileReader?(n=new FileReader,n.readAsArrayBuffer(e),n.onerror=function(){return r.reject("Failed to read image from disk")},n.onload=function(){var i;return i=image_type_from_array_buffer(n.result),i==="image/bmp"?r.reject("You selected a BMP file that has a wrong extension. Please use an image editing program to convert it to a PNG, JPEG, or GIF."):i?r.resolve():r.reject(UNKNOWN_IMAGE_FORMAT_ERROR)}):r.resolve()}}(this))},I.image_dimensions=function(e){return $.Deferred(function(t){var r,n;return n=typeof URL!="undefined"&&URL!==null&&typeof URL.createObjectURL=="function"?URL.createObjectURL(e):void 0,n?(r=new Image,r.src=n,r.onload=function(){return t.resolve([r.width,r.height])},r.onerror=function(){return t.reject(UNKNOWN_IMAGE_FORMAT_ERROR)}):t.reject(UNKNOWN_IMAGE_FORMAT_ERROR)})},I.video_dimensions=function(e){return $.Deferred(function(t){var r,n;return n=document.createElement("video"),r=typeof URL!="undefined"&&URL!==null&&typeof URL.createObjectURL=="function"?URL.createObjectURL(e):void 0,r?(n.src=r,n.onloadedmetadata=function(){return t.resolve([n.videoWidth,n.videoHeight])},n.onerror=function(){return t.reject("Invalid video file")}):t.reject("Invalid video file")})},I.test_image_dimensions=function(e,t,r){return t==null&&(t=3840),r==null&&(r=2160),I.image_dimensions(e).then(function(n){return function(i){var o,a;return a=i[0],o=i[1],$.Deferred(function(u){return a>t||o>r?u.reject("Image is greater than the maximum dimensions of "+t+"x"+r+" (you selected a "+a+"x"+o+" image)"):u.resolve()})}}(this))};var Upload=I.Upload=function(){e.prototype.kind="upload";function e(t,r,n){this.editor=t,this.file=r,this.opts=n!=null?n:{},this.save_upload=bind(this.save_upload,this),this.decrement=bind(this.decrement,this),this.increment=bind(this.increment,this)}return e.prototype.upload_params=function(){return{kind:this.kind,filename:this.file.name}},e.prototype.progress=function(t,r){},e.prototype.save_params=function(){return{}},e.prototype.save_url=function(){return this.upload_data.success_url},e.prototype.start_upload=function(){if(this.upload_data){console.warn("Attempt to start_upload when upload has already been started");return}return this.prepare_upload().then(function(t){return function(){return t.start_xhr_upload()}}(this)).then(function(t){return function(){return t.save_upload()}}(this))},e.prototype.increment=function(){var t,r;if((t=this.constructor).active_uploads||(t.active_uploads=0),this.constructor.active_uploads++,this.constructor.active_uploads===1)return typeof(r=this.opts).start_uploading=="function"?r.start_uploading():void 0},e.prototype.decrement=function(){var t;if(this.constructor.active_uploads--,this.constructor.active_uploads===0)return typeof(t=this.opts).stop_uploading=="function"?t.stop_uploading():void 0},e.prototype.prepare_upload=function(){return this.editor.prepare_upload().then(function(t){return function(){return I.prepare_upload(t.editor.upload_prefix(),t.upload_params()).done(function(r){t.upload_data=r})}}(this))},e.prototype.start_xhr_upload=function(){var t,r,n,i,o,a;if(!this.upload_data)throw"missing upload data";this.increment(),t=$.Deferred().always(function(u){return function(){return u.decrement()}}(this)),r=new FormData,i=this.upload_data.post_params;for(n in i)o=i[n],r.append(n,o);return r.append("file",this.file),a=new XMLHttpRequest,a.upload.addEventListener("progress",function(u){return function(s){if(s.lengthComputable)return u.progress(s.loaded,s.total)}}(this)),a.upload.addEventListener("error",function(u){return function(s){return I.event("upload","xhr error",u.kind)}}(this)),a.upload.addEventListener("abort",function(u){return function(s){return I.event("upload","xhr abort",u.kind)}}(this)),a.addEventListener("readystatechange",function(u){return function(s){var l;if(a.readyState===4){if(Math.floor(a.status/100)===2)return I.event("upload","save",u.kind),t.resolve();if(l="Failed upload.",a.responseXML)try{l=a.responseXML.querySelector("Error Message").innerHTML}catch(c){s=c}else l=a.responseText;return I.event("upload_error","server error "+a.status+": "+l,u.kind),t.reject({errors:[l]})}}}(this)),a.open("POST",this.upload_data.action),a.send(r),t},e.prototype.save_upload=function(){if(!this.upload_data){console.warn("attempted to call save_upload without upload_data");return}return catch_server_error($.ajax({url:this.save_url(),data:I.with_csrf(this.save_params()),dataType:"json",type:"post"})).then(function(t){return function(r){return r.errors?$.Deferred().reject(r):r}}(this))},e}(),ImageUpload=I.ImageUpload=function(e){extend2(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}return t.prototype.kind="image",t.delete_image=function(r,n,i){return $.ajax({url:r.upload_prefix()+"/image/delete/"+n,type:"post",data:I.with_csrf(),success:i})},t}(I.Upload),MockUpload=function(e){extend2(t,e),t.prototype.stage_delay=500,t.prototype.mock_prepare_result={id:123},t.prototype.mock_save_result={success:!0};function t(){this.save_upload=bind(this.save_upload,this),this.start_xhr_upload=bind(this.start_xhr_upload,this),this.prepare_upload=bind(this.prepare_upload,this),t.__super__.constructor.apply(this,arguments),console.warn("MockUpload:new "+this.file.name)}return t.prototype.prepare_upload=function(){return console.warn("MockUpload: prepare_upload"),this.editor.prepare_upload().then(function(r){return function(){return $.Deferred(function(n){return setTimeout(function(){return r.upload_data=r.mock_prepare_result,n.resolve(r.upload_data)},r.stage_delay)})}}(this))},t.prototype.start_xhr_upload=function(){var r,n,i,o,a,u;return console.warn("MockUpload: start_xhr_upload"),r=20,i=(o=this.file.size)!=null?o:1234,n=0,u=0,a=this.stage_delay/r*5,$.Deferred(function(s){return function(l){var c;return s.progress(0,i),c=function(){return setTimeout(function(){return u+=1,s.progress(Math.floor(u/r*i),i),u===r?l.resolve():c()},a)},c()}}(this))},t.prototype.save_upload=function(){return console.warn("MockUpload: save_upload"),$.Deferred(function(r){return function(n){return setTimeout(function(){return n.resolve(r.mock_save_result)},r.stage_delay)}}(this))},t}(I.Upload);I.pick_files=function(e){var t;return e==null&&(e={}),t=e.input?$(e.input):($("input.pick_files_input").remove(),$("<input type='file' class='pick_files_input' />").hide().insertAfter("body")),$.Deferred(function(r){return function(n){return e.multiple&&t.attr("multiple",!0),e.accept&&t.attr("accept",e.accept),t.on("change",function(i){var o,a,u,s,l,c,f;for(l=function(){var d,p,g,y;for(g=i.target.files,y=[],d=0,p=g.length;d<p;d++)u=g[d],y.push(u);return y}(),a=[],typeof e.on_pick_files=="function"&&e.on_pick_files(l),c=0,f=l.length;c<f;c++)s=l[c],e.max_size&&s.size>e.max_size&&a.push(["You selected an image greater than the max size "+I.format_bytes(e.max_size)+" (you selected a "+I.format_bytes(s.size)+" file)",s]);if(a.length){n.reject(a,l);return}return e.test_file?(o=l.map(function(d){return $.Deferred(function(p){return e.test_file(d,p),setTimeout(function(){if(n.state()==="pending")return p.reject("Timed out checking file, are you sure it was an image file?")},1e3)}).catch(function(p){throw[p,d]})}),$.when.apply($,o).done(function(d){return n.resolve(l)}).fail(function(d){return n.reject([d])})):n.resolve(l)}),t.click()}}(this))},I.xhr_upload=function(e,t){return $.Deferred(function(r){return function(n){var i,o,a,u,s;i=new FormData,a=t.post_params;for(o in a)u=a[o],i.append(o,u);return i.append("file",e),s=new XMLHttpRequest,s.upload.addEventListener("progress",function(l){if(l.lengthComputable)return n.notify("progress",l.loaded,l.total)}),s.upload.addEventListener("error",function(l){return n.reject("xhr error")}),s.upload.addEventListener("abort",function(l){return n.reject("xhr aborted")}),s.addEventListener("readystatechange",function(l){var c;if(s.readyState===4){if(Math.floor(s.status/100)===2)return n.resolve();if(c="Failed upload.",s.responseXML)try{c=s.responseXML.querySelector("Error Message").innerHTML}catch(f){l=f}else c=s.responseText;return n.reject(c)}}),s.open("POST",t.action),s.send(i)}}(this))},I.upload_image=function(e){return e==null&&(e={}),e.accept||(e.accept="image/png,image/jpeg,image/gif"),e.file_params=function(t){return t.type==="video/mp4"?I.video_dimensions(t).then(function(r){return function(n){var i,o;return o=n[0],i=n[1],{width:o,height:i}}}(this)):I.image_dimensions(t).then(function(r){return function(n){var i,o;return o=n[0],i=n[1],{width:o,height:i}}}(this))},I.upload_file(e)},I.upload_file=function(e){var t,r,n,i,o,a;if(e==null&&(e={}),!e.url)throw new Error("missing url for upload image");return t=e.accept,r=e.max_size,n=e.multiple,i=e.on_pick_files,o=e.on_start_upload,a=e.test_file,I.pick_files({accept:t,max_size:r,multiple:n,test_file:a,on_pick_files:i}).then(function(u){return function(s){var l,c;if(!n&&s.length>1)throw"Got multiple files for single upload";return c=function(){var f,d,p,g;for(p=s.slice(0,6),g=[],f=0,d=p.length;f<d;f++)l=p[f],g.push(function(y){var x;return x=e.file_params?e.file_params(y):{},$.when(x).then(function(w){return function(v){return $.ajax({url:e.url,type:"post",xhrFields:{withCredentials:!0},data:I.with_csrf($.extend({filename:y.name,thumb_size:e.thumb_size,action:"prepare"},v))}).then(function(m){var h;return m.errors?$.Deferred().reject(m.errors):(h=I.xhr_upload(y,m).then(function(){return $.ajax({url:m.success_url,type:"post",xhrFields:{withCredentials:!0},data:I.with_csrf()})}),typeof o=="function"&&o(y,m,h),h)})}}(this))}(l));return g}(),n?$.when.apply($,c):c[0]}}(this))},I.make_upload_button=function(e,t){var r,n;return r=null,n=e.data("max_size"),e.on("click",function(i){return function(o){var a;return r&&r.remove(),r=$("<input type='file' multiple />").hide().insertAfter(e),(a=e.data("accept"))&&r.attr("accept",a),r.on("change",function(){var u,s,l,c,f;for(c=r[0].files,f=[],s=0,l=c.length;s<l;s++){if(u=c[s],n!=null&&u.size>n){I.flash(u.name+" is greater than max size of "+I.format_bytes(n),"error");continue}f.push(typeof t=="function"?t(u):void 0)}return f}),r.insertAfter(e),r.click()}}(this))};var React2=window.React,ReactDOM2=window.ReactDOM,ReactDOMFactories=window.ReactDOMFactories,ReactTransitionGroup=window.ReactTransitionGroup,PropTypes=window.PropTypes,classNames2=window.classNames,R2=window.R;React2||I2.libs.react.done(function(){return React2=window.React,ReactDOM2=window.ReactDOM,ReactDOMFactories=window.ReactDOMFactories,ReactTransitionGroup=window.ReactTransitionGroup,PropTypes=window.PropTypes,classNames2=window.classNames,R2=window.R});var CloseIcon=null;I2.libs.react.done(function(){var e,t;return e=ReactDOMFactories,t=e.img,CloseIcon=function(r){var n,i,o,a,u;return r==null&&(r={}),u=(i=r.width)!=null?i:24,n=(o=r.height)!=null?o:u,React2.createElement("svg",{className:"svgicon icon_close",strokeLinecap:"round",stroke:"currentColor",role:"img",version:"1.1",viewBox:"0 0 24 24",strokeWidth:(a=r.stroke_width)!=null?a:"2",width:u,height:n,strokeLinejoin:"round","aria-hidden":!0,fill:"none"},React2.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),React2.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"}))},CloseIcon=React2.createElement.bind(null,React2.memo(CloseIcon))});var Lightbox2=null,ErrorLightbox=null,open_lightbox=null;I.libs.react.done(function(){var e,t,r,n,i,o,a,u;return e=ReactDOMFactories,t=e.a,i=e.div,r=e.button,a=e.label,o=e.h2,u=e.p,n=null,open_lightbox=function(s){return s.promise?(I.Lightbox.open_loading(),s.then(function(l){return function(c){return I.Lightbox.open(c)}}(this))):I.Lightbox.open(s)},Lightbox2=R2.component("Lightbox",{is_modal_dialog:function(){var s;return s=document.getElementById("lightbox_container"),s!=null?s.contains(this.container_ref.current):void 0},getInitialState:function(){return{}},componentDidMount:function(){if(this.is_modal_dialog())return n?console.warn("A dialog already has the focus trap"):(this.detect_focus=function(s){return function(l){var c;if(c=s.container_ref.current,c&&"contains"in c&&!(c===l.target||c.contains(l.target)))return c.focus()}}(this),$(document.body).on("focusin",this.detect_focus),n=this),this.setState({previously_focused:document.activeElement,is_modal_dialog:!0},function(){return _.defer(function(s){return function(){var l;return(l=s.container_ref.current)!=null?l.focus():void 0}}(this))})},componentWillUnmount:function(){var s;return this.detect_focus&&($(document.body).off("focusin",this.detect_focus),n=null,delete this.detect_focus),(s=this.state.previously_focused)!=null?s.focus():void 0},close:function(){return I.Lightbox.close()},render:function(){return i({className:classNames("lightbox",this.props.className),style:this.props.style,role:this.state.is_modal_dialog?"dialog":void 0,"aria-modal":this.state.is_modal_dialog?"true":void 0,tabIndex:this.state.is_modal_dialog?-1:void 0,ref:this.container_ref||(this.container_ref=React.createRef())},this.props.close!==!1?r({className:"close_button",type:"button","aria-label":"Close Dialog"},CloseIcon({width:18})):void 0,this.props.children)}}),ErrorLightbox=R2.component("ErrorLightbox",{propTypes:{title:PropTypes.string,errors:PropTypes.array.isRequired},render:function(){return Lightbox2({className:classNames(this.enclosing_class_name(),"compact")},o({},this.props.title||this.tt("misc.lightboxes.error_title")),R2.Forms.FormErrors({title:!1,errors:this.props.errors}),u({className:"buttons"},r({className:"button",type:"button",onClick:function(s){return function(){return I.Lightbox.close()}}(this)},"Close")))}})});var ImagePicker,LayoutImageUpload,extend3=function(e,t){for(var r in t)hasProp4.call(t,r)&&(e[r]=t[r]);function n(){this.constructor=e}return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},hasProp4={}.hasOwnProperty,bind2=function(e,t){return function(){return e.apply(t,arguments)}};LayoutImageUpload=function(e){extend3(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}return t.prototype.upload_params=function(){return{type:"layout",filename:this.file.name}},t.prototype.save_params=function(){return{thumb_size:"original"}},t}(ImageUpload),ImagePicker=function(){function e(t,r,n){this.editor=r,n==null&&(n=null),n&&(this.update=n),this.el=jquery_default(t),this.make_upload_btn(),this.el.dispatch("click",{remove_image_btn:function(i){return function(o){return i.el.removeClass("has_image").find(".image_preview").css("background-image","").end().find(".image_id_input").val("").end().data("image_url",""),i.send_update()}}(this)}),this.el.on("change",function(i){return function(o){return i.send_update()}}(this)),this.send_update()}return e.prototype.upload_prefix=function(){return this.editor.upload_prefix()},e.prototype.prepare_upload=function(){return jquery_default.Deferred().resolve()},e.prototype.update=function(){},e.prototype.send_update=function(){var t,r,n,i,o,a,u;if(n=this.el.data("image_name"),u=this.el.data("image_url"),!u)return this.update(n,void 0);for(o={url:u},a=this.el.find(".image_option"),t=0,r=a.length;t<r;t++)i=a[t],i=jquery_default(i),o[i.data("name")]=i.find("select").val();return this.update(n,o)},e.prototype.make_upload_btn=function(){if(!this.upload_btn)return this.progress_inner||(this.progress_inner=this.el.find(".progress_inner")),this.upload_btn=this.el.find(".upload_image_btn").on("click",function(t){return function(){return I2.pick_files({accept:"image/png,image/jpeg,image/gif",test_file:function(r,n){return jquery_default.when(I2.test_image_dimensions(r),I2.test_image_format(r)).done(function(i){return function(){return n.resolve()}}(this)).fail(function(i){return function(o){return n.reject(o)}}(this))},max_size:t.upload_btn.data("max_size")}).fail(function(r){var n,i,o;return o=r[0],n=o[0],i=o[1],open_lightbox(ErrorLightbox({errors:[i.name+": "+n]}))}).then(function(r){var n,i;return n=r[0],i=new LayoutImageUpload(t,n),t.progress_inner.css({width:""}),t.el.addClass("uploading"),i.start_upload().fail(function(o){return t.el.removeClass("uploading"),open_lightbox(ErrorLightbox({errors:o.errors}))}).done(function(o){return t.el.removeClass("uploading").addClass("has_image").find(".image_preview").css("background-image","url("+o.url+")").end().find(".image_id_input").val(i.upload_data.upload_id).end().data("image_url",o.url),t.send_update()})})}}(this))},e}();var AppearanceEditor2=I2.AppearanceEditor=function(){AppearanceEditor.ImageUpload=LayoutImageUpload,AppearanceEditor.ImagePicker=ImagePicker;function AppearanceEditor(e,t){this.data=t,this.set_height=bind2(this.set_height,this),this.css_template=bind2(this.css_template,this),this.el=jquery_default(e),this.style=_2.extend({},this.data),this.refresh_style=_2.debounce(function(r){return function(){return r.constructor.prototype.refresh_style.apply(r,arguments)}}(this),0),this.setup_color_picker(),this.setup_image_picker(),this.setup_text_areas(),this.setup_form(),this.el.dispatch("click",{toggle_editor_btn:function(r){return function(){return r.toggle()}}(this)}),window.location.hash.match(/\bedit\b/)&&_2.defer(function(r){return function(){return r.toggle()}}(this)),jquery_default(window).on("resize",_2.debounce(function(r){return function(){return r.set_height()}}(this),100))}return AppearanceEditor.prototype.css_template=function(){var template_code;if(!this.css_template_fn){if(template_code=this.el.data("css_template"),!template_code)return;this.css_template_fn=eval(template_code)}return this.css_template_fn.apply(this,arguments)},AppearanceEditor.prototype.set_height=function(){var e,t,r,n,i;return t=this.el.find(".appearance_editor_inner"),e=jquery_default("html").outerHeight(!0),i=jquery_default(window).height(),r=t.outerHeight(!0),r>i?(n=Math.max(e,i,r),this.el.height(n).css({bottom:"",position:""})):this.el.height("").css({bottom:"0",position:"fixed"})},AppearanceEditor.prototype.toggle=function(){var e;return e=jquery_default(document.body).toggleClass("show_appearance_editor"),this.set_height(),this.el.addClass("animating"),setTimeout(function(t){return function(){return t.el.removeClass("animating"),t.set_height()}}(this),200)},AppearanceEditor.prototype.refresh_style=function(){},AppearanceEditor.prototype.upload_prefix=function(){throw"override me"},AppearanceEditor.prototype.update_image=function(e,t){return this.style[e]=t,this.refresh_style()},AppearanceEditor.prototype.update_color=function(e,t){return this.style[e]=t,this.refresh_style()},AppearanceEditor.prototype.setup_form=function(){return this.el.find("form").remote_submit(function(e){return function(t){t.errors&&alert(t.errors.join(", "))}}(this))},AppearanceEditor.prototype.setup_text_areas=function(){return this.el.on("focusin focusout",".text_field",function(e){return function(t){return jquery_default(t.currentTarget).toggleClass("open",t.type==="focusin")}}(this))},AppearanceEditor.prototype.setup_image_picker=function(){var e,t;return t=this.el.find(".image_picker"),this.image_pickers=function(){var r,n,i;for(i=[],r=0,n=t.length;r<n;r++)e=t[r],i.push(new ImagePicker(jquery_default(e),this,function(o){return function(){return o.update_image.apply(o,arguments)}}(this)));return i}.call(this)},AppearanceEditor.prototype.setup_color_picker=function(){var e,t,r,n;for(this.el.dispatch("click",{color_preview:function(i){return function(o){return i.open_color_picker(o.closest(".color_picker"))}}(this)}),this.el.on("click",".color_picker .close_btn",function(i){return function(o){var a;return a=jquery_default(o.target).closest(".color_picker"),a.data("close")()}}(this)),this.el.find("input[type='text']").on("focus",function(i){return function(o){return i.open_color_picker(jquery_default(o.target).closest(".color_picker"),!1)}}(this)),n=this.el.find(".color_picker"),e=0,t=n.length;e<t;e++)r=n[e],r=jquery_default(r),this.set_picker_color(r,this.style[r.find("[data-name]").data("name")]);return n.on("keyup","input",function(i){return function(o){var a,u;return a=jquery_default(o.currentTarget).val(),(u=jquery_default(o.delegateTarget).data("farb"))!=null?u.setColor(a):void 0}}(this)),n.on("change","input",function(i){return function(o){var a,u;if(r=jquery_default(o.delegateTarget),a=(u=r.data("farb"))!=null?u.color:void 0)return r.find("input").val(a)}}(this))},AppearanceEditor.prototype.set_picker_color=function(e,t){var r,n,i,o,a,u,s;return r=e.data("farb")||new jquery_default._farbtastic(jquery_default()),i=e.find("input"),t?i.val(t):t=i.val(),a=e.find(".color_preview"),i=e.find("input"),u=r.RGBToHSL(r.unpack(t)),n=u[0],s=u[1],o=u[2],a.toggleClass("is_bright",o>.9),a.css("backgroundColor",t),this.update_color(e.find("[data-name]").data("name"),t)},AppearanceEditor.prototype.open_color_picker=function(e,t){var r,n,i,o,a,u,s,l,c;if(t==null&&(t=!0),e.is(".flyout_open"))return t&&e.data("close")(),!1;for(c=this.el.find(".color_picker"),i=0,a=c.length;i<a;i++)u=c[i],typeof(r=jquery_default(u).data("close"))=="function"&&r();return s=jquery_default(`<div class="color_popup input_flyout">
  <div class="close_btn">&times;</div>
  <div class="farb"></div>
</div>`),o=e.find("input"),l=e.find(".color_preview"),e.data("close",function(f){return function(){return s.removeClass("open"),e.removeClass("flyout_open").removeData("farb"),jquery_default(document.body).off("click.color_picker"),jquery_default(window).off("keydown.color_picker"),setTimeout(function(){return s.remove()},200)}}(this)),n=jquery_default.farbtastic(s.find(".farb"),function(f){return function(d){return f.set_picker_color(e,d)}}(this)),e.data("farb",n),n.setColor(o.val()),jquery_default(document.body).on("click.color_picker",function(f){return function(d){if(!jquery_default(d.target).closest(".color_picker").length)return e.data("close")()}}(this)),jquery_default(window).on("keydown.color_picker",function(f){return function(d){if(d.keyCode===27)return e.data("close")()}}(this)),e.append(s).addClass("flyout_open"),_2.defer(function(f){return function(){return s.addClass("open")}}(this))},AppearanceEditor}(),slice5=[].slice,theme_template_scope=I2.theme_template_scope||(I2.theme_template_scope={first:function(e,t,r,n){var i,o;return(i=(o=e!=null?e:t)!=null?o:r)!=null?i:slice5.call(arguments).find(function(a){return function(u){return u!=null}}(this))},when:function(e,t,r,n){return e===t?r:n},sub_color2:Color.sub_color2,sub_color:Color.sub_color,mix_color:Color.mix_color,alpha:function(e,t){var r,n,i,o;return o=Color.parse_color_safe(e),i=o[0],n=o[1],r=o[2],"rgba("+i+", "+n+", "+r+", "+t+")"},bg_color_for_input:function(e){var t,r,n;return t=Color.sub_color2(e,.1),r=Color.luma.apply(Color,Color.parse_color_safe(e)),n=Math.min(1,Math.max(0,(r-.5)*2)),Color.mix_color("#ffffff",t,n)},text_color_for_bg:function(e){return Color.readable_text_color(e)},text_shadow_color_for_bg:function(e){var t;return t=Color.relative_luma.apply(Color,Color.parse_color_safe(e)),t>=.45?"transparent":Color.sub_color2(e)}}),bind3=function(e,t){return function(){return e.apply(t,arguments)}},extend4=function(e,t){for(var r in t)hasProp5.call(t,r)&&(e[r]=t[r]);function n(){this.constructor=e}return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},hasProp5={}.hasOwnProperty,WidgetAppearanceEditor=function(e){extend4(t,e);function t(r,n){this.parent=n,this.refresh_style=bind3(this.refresh_style,this),t.__super__.constructor.call(this,r)}return t.prototype.refresh_style=function(r){var n,i,o,a,u,s,l,c,f,d,p;return this._style||(this._style=jquery_default("#widget_theme")),p=jquery_default.extend(Object.create(theme_template_scope),this.el.data("default_style"),r),i=this.css_template(p),(l=this._style)!=null&&l.remove(),this._style=jquery_default("<style type='text/css'>"+i+"</style>").appendTo(jquery_default("head")),c=Color.parse_color_safe(p.bg_color),s=c[0],o=c[1],n=c[2],f=Color.rgb_to_hsl(s,o,n),a=f[0],d=f[1],u=f[2],this.parent.el.toggleClass("dark",u<60)},t}(AppearanceEditor2),ReferrerTracker=I2.ReferrerTracker||(I2.ReferrerTracker=function(){function e(){}return e.MAX_ITEMS=20,e.get_cookie=function(){return window.Cookies.getJSON("itchio_refs")||[]},e.write_cookie=function(t){return I2.set_cookie("itchio_refs",t,{expires:14})},e.has_ref=function(t,r){var n,i,o,a,u,s;for(r=+r,u=e.get_cookie(),o=0,a=u.length;o<a;o++)if(s=u[o],i=s[0],n=s[1],i===t&&n===r)return!0;return!1},e.push=function(t,r,n){var i,o;if(n&&n.length>0){for(r=+r,o=function(){var a,u,s,l;for(s=this.get_cookie(),l=[],a=0,u=s.length;a<u;a++)i=s[a],!(i[0]===t&&i[1]===r)&&l.push(i);return l}.call(e),I2.in_dev&&console.log("pushing referrer",[t,r,n]),o.unshift([t,r,n]);o.length>e.MAX_ITEMS;)o.pop();return e.write_cookie(o)}},e}()),wait_until_font_loaded;wait_until_font_loaded=function(e,t,r){var n,i,o,a;if(r==null&&(r=10),i=e.find(".icon"),!i.length)return t();if(i.width()===0){setTimeout(t,100);return}return o=10,a=20,n=function(){if(a-=1,o+=2,i.width()>r)return t();if(a>0)return setTimeout(n,o)},setTimeout(n,o)},I.EmbedWidget=function(){function e(t){var r;this.el=jquery_default(t),this.game=this.el.data("game"),this.setup_tracking(),this.el.dispatch("click",{purchase_popup_btn:function(n){return function(i){var o,a,u,s,l;return l=680,o=400,u=(screen.height-o)/2,a=(screen.width-l)/2,s=window.open(i.attr("href"),"purchase","scrollbars=1, resizable=no, width="+l+", height="+o+", top="+u+", left="+a),typeof s.focus=="function"?s.focus():void 0}}(this)}),r=this.el.find("h1.game_title"),wait_until_font_loaded(r,function(n){return function(){return I.adjust_font_size_to_fit(r)}}(this))}return e.prototype.setup_tracking=function(){if(document.referrer)return ReferrerTracker.push("game",this.game.id,"embed:"+document.referrer)},e.prototype.set_style=function(t){return this.appearance_editor||(this.appearance_editor=new WidgetAppearanceEditor(jquery_default(".widget_appearance_widget"),this)),this.appearance_editor.refresh_style(t)},e}()})();
